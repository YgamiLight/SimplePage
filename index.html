<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
    <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .slides{
            max-width:800px;
            height:600px;
            margin:0 auto;
            position: relative;
            overflow: hidden;
        }
        .window{
            display: flex;
            transition: transform 0.3s;
        }
        .window li{
            width:100%;
            flex-shrink: 0;
        }
        .window img {
            width:100%;
            height:600px;
            vertical-align: top;
        }
        .slides .controls{
            position: absolute;
            bottom:20px;
            left:50%;
            transform: translateX(-50%);
        }
        .slides .controls li{
            float: left;
            width:40px;
            height:10px;
            background-color: rgba(155,155,155,0.7);
            margin-right:20px;
        }
        .slides .controls li.active{
            background-color: #ddd;
            opacity: 0.8;
        }

        .leftArrow,.rightArrow{
            position: absolute;
            top:50%;
            transform: translateY(-50%);
            font-size:4em;
            color:blue;
        }
        .leftArrow,.rightArrow:hover{
            cursor: pointer;
        }

        .leftArrow{
            left: 10px;
        }
        .rightArrow{
            right:10px;
        }
    </style>
</head>
<body>
        <div class="UserImg">
            <div class="wrapContainer">
                <div class="imgWrapper">
                    <img src="https://i.loli.net/2017/08/13/598fc9abd3bf1.jpg
" alt="">
            </div>
            </div>
            <div class="description">
            <span>我的回合<b>抽牌！</b></span>
            <span>觉醒我的<b>中二之魂！</b></span>
            <span>我的<b>第一部日漫</b></span>
            <span><b>现在</b>也偶尔<b>重温</b></span>
            </div>
    </div>
    <div class="mainMessage">
        <h2>游戏王</h2>
        <p>讲述了主角用卡牌怪兽决斗和七件千年神器为主线的故事。</p>
        <p>该动画里的卡牌组合丰富多样，而且具有魔法，陷阱，怪兽几个种类。把不同种类不同卡片组合在一起可以发挥超强的威力</p>
    </div>
        <div class="slides">
            <ul class="window">
                <li><img src="//ooo.0o0.ooo/2017/09/23/59c5d613b06b9.jpg" alt=""></li>
                <li><img src="//ooo.0o0.ooo/2017/09/23/59c5d61465b67.jpg" alt=""></li>
                <li><img src="//ooo.0o0.ooo/2017/09/23/59c5d615e2a70.jpg" alt=""></li>
                <li><img src="//ooo.0o0.ooo/2017/09/23/59c5d615ef5ab.jpg" alt=""></li>
            </ul>
            <ul class="controls">
                <li class="active"></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
            <div class="leftArrow">&lt</div>
            <div class="rightArrow">&gt</div>
        </div>
        <script>
            var current = 0;
            var $slides = $('.slides')
            var $window = $('.window');
            var $controls = $('.controls');
            var $leftArrow = $('.leftArrow');
            var $rightArrow = $('.rightArrow');
            $controls.on('click','li',function (e) {
                clearInterval(timer);
                var $li = $(e.currentTarget);
                $li.addClass('active').siblings().removeClass('active');
                var index = $li.index();
                current = index;
                var width = $slides.width();
                $window.css('transform','translateX('+ (-index*width) + 'px)');
            })
            $rightArrow.on('click',function(){
                clearInterval(timer);
                window.timer = setInterval(function(){
                    $rightArrow.click();
                },2000)
                current = current + 1;
                if(current >  $('.window>li').length-1){
                    current = 0;
                }
                var width = $slides.width();
                $window.css('transform','translateX('+ (-current*width) + 'px)');
                $($('.controls>li')[current]).addClass('active').siblings().removeClass('active');
            })
            $leftArrow.on('click',function(){
                clearInterval(timer);
                window.timer = setInterval(function(){
                    $rightArrow.click();
                },2000)
                current = current - 1;
                if(current <  0){
                    current = $('.window>li').length-1;
                }
                var width = $slides.width();
                $window.css('transform','translateX('+ (-current*width) + 'px)');
                $($('.controls>li')[current]).addClass('active').siblings().removeClass('active');
            })
            var timer = setInterval(function(){
                $rightArrow.click();
            },2000)
        </script>
        <div class="container">
            <h2>登场人物介绍</h2>
            <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/599015480b235.jpg
" alt="">
                    </div>
                    <h3>暗游戏</h3>
                    <p>三千年埃及的法老王，是武藤游戏的第二个人格。</p>
                </div>
                <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/599015477044a.jpg" alt="">
                    </div>
                    <h3>
                        武藤游戏</h3>
                    <p>一名喜欢玩游戏的普通中学生</p>
                </div>
                <div class="personWrapper">
                    <div class="oneToOne">
                   <img src="https://i.loli.net/2017/08/13/59901547bf311.jpg" alt="">
                    </div>
                    <h3>海马濑人</h3>
                    <p>海马娱乐集团董事长、决斗学院的创始人，仅次于武藤游戏的传说级决斗者。</p>
                </div>
                <div class="personWrapper">
                <div class="oneToOne">
                   <img src="https://i.loli.net/2017/08/13/5990154797460.jpg" alt="">
                    </div>
                    <h3>女枪手</h3>
                    <p>生活在天界的神枪手，是善于利用枪械击毙远距离敌人的战士。</p>
                </div>
                <div class="personWrapper">
                   <div class="oneToOne">
                       <img src="https://i.loli.net/2017/08/13/59901547abd44.jpg" alt="">
                 </div>
                    <h3>圣职者</h3>
                    <p>为除恶扬善和普度众生而接受残酷训练的虔诚信徒。
</p>    </div>

                <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/599015477153d.jpg" alt="">
                    </div>
                    <h3>暗夜使者</h3>
                    <p>用敏捷的身手执行特别任务的暗精灵成员。</p>
                </div>
                <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/59901547d59a2.jpg" alt="">
                    </div>
                    <h3>男法师</h3>
                    <p>生活在恶劣条件下的魔族，为了打败对手可以不惜一切代价。</p>
                </div>
                <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/59901547eb1a5.jpg" alt="">
                    </div>
                    <h3>女魔法师</h3>
                    <p>拥有俏丽可爱的外形，并且善用魔法力量攻击敌人的魔族。</p>
                </div>
                <div class="personWrapper">
                    <div class="oneToOne">
                        <img src="https://i.loli.net/2017/08/13/5990154809d71.jpg" alt="">
                    </div>
                    <h3>魔枪士</h3>
                    <p>使用蕴含魔力的长枪，专研枪术的战士。</p>
                </div>
    </div>

        <script>
            var preLoadingImg = new Image();
            preLoadingImg.src = 'https://i.loli.net/2017/08/13/599025370adda.gif';
        //找到我的页面
        var container = document.querySelector('.container');
        //初始化hasNextPage这个值，使页面至少能够加载一次。
        var hasNextPage = 'true';
        //初始化页码
        var n = 2;
        var lazyLoad = 1;
        var finished = true;
        $(window).scroll(function() {
            //判断用户是否滚动到了文档的底部
            if($(window).scrollTop() + $(window).height() === $(document).height()) {
                //此代码用与判断Ajax是否请求完毕，如果没有请求完毕则下次用户滚到屏幕最下方的时候不请求Ajax（防止出现用户在低网速的时候多次滚屏造成Ajax多次请求的情况)
                if(!finished){return}
                //首先判断查看页码是否为true
                var isTrue = (hasNextPage === 'true');
                //根据页码判断是否请求AJAX
                if(isTrue){
                    finished = false;
                    var request =  new XMLHttpRequest();
                    request.open('GET','./page-'+n+'.html');
                    request.onload = function(){
                        //Ajax对服务器发送的数据进行处理，把后台传入的数据用JSON格式解析
                        var obj = JSON.parse(request.response);
                        n += 1;
                        for(var i = 0;i<obj.length-1;i++){
                            var  string = '<div class="personWrapper"><div class="oneToOne">' + '<img style="width:100%" data-xxx=' + obj[i]['url'] +Math.random().toFixed(6)+ ' data-index='+lazyLoad + ' alt="" src="https://i.loli.net/2017/08/13/599025370adda.gif">'+'</div>'+'<p>'+obj[i]['text'] +'</p>'+'</div>';
                            container.insertAdjacentHTML('beforeend',string)
                        }
                        hasNextPage = obj[obj.length-1]['hasNextPage'];
                        finished = true;
                    }
                    request.send();
                }
                //把数据解析为JSON以后把页码传给最外面的值方便判断是否继续请求AJAX
            }
            var imgs = $('img[data-index='+lazyLoad+']');
            for(var k = 0;k<imgs.length;k++){
                if($(window).scrollTop() + $(window).height() >= $(imgs[k]).offset().top) {
                    imgs[k].src = imgs[k].getAttribute('data-xxx');
                }
            }
        });
        </script>
</body>
</html>